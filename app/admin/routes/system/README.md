# 管理员路由单元测试

这个目录包含了管理员路由处理器的单元测试。

## 文件说明

- `admin.go` - 管理员路由处理器的主要实现
- `admin_test.go` - 完整的单元测试套件

## 测试覆盖范围

### 测试的路由处理函数

1. **获取所有管理员** (`all`) - 成功和服务错误情况
2. **获取管理员列表** (`list`) - 分页查询测试
3. **获取管理员详情** (`detail`) - 成功和不存在的情况
4. **添加管理员** (`add`) - 成功和参数验证错误
5. **编辑管理员** (`edit`) - 成功情况
6. **删除管理员** (`delete`) - 成功和服务错误情况
7. **修改管理员状态** (`changeStatus`) - 成功和参数验证错误

### 额外测试

- HTTP方法不匹配测试
- 路径不存在测试
- 基准性能测试

## 运行测试

### 运行所有测试
```bash
go test -v ./app/admin/routes/system/
```

### 运行测试并查看覆盖率
```bash
go test -cover ./app/admin/routes/system/
```

### 运行基准测试
```bash
go test -bench=BenchmarkAdminRoutes_All -run=^$ ./app/admin/routes/system/
```

## 测试架构

### Mock对象

- `MockAdminService` - 模拟管理员业务服务
- `MockJwtService` - 模拟JWT认证服务

### 测试特点

1. **完全隔离** - 使用mock对象，不依赖数据库或外部服务
2. **响应验证** - 验证HTTP状态码和业务响应码
3. **错误处理** - 测试各种错误情况和边界条件
4. **参数验证** - 测试输入参数的验证逻辑

## 注意事项

- 所有HTTP响应都使用200状态码，业务逻辑的成功/失败通过响应体中的`code`字段区分
- 成功响应的业务代码是200
- 参数验证错误的业务代码是310
- 系统错误的业务代码是500

## 当前测试覆盖率

- **61.7%** 的代码覆盖率

## 性能基准

在12th Gen Intel Core i7-12700上的基准测试结果：
- 71,641次迭代/秒
- 平均每次操作约16.2微秒 